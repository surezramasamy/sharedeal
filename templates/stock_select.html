<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Stocks to Analyze</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    #stockList { max-height: 60vh; overflow-y: auto; border: 1px solid #ddd; border-radius: 0.375rem; }
    .form-check-input { cursor: pointer; }
    .sticky-top { background: white; z-index: 1000; padding: 1rem 0; border-bottom: 1px solid #ddd; }
  </style>
</head>
<body class="bg-light">

<!-- FIXED: FORM WRAPS ENTIRE PAGE -->
<form method="post" action="/add-selected" id="stockForm">

  <div class="container mt-4">

    <!-- TOP: SEARCH + ADD BUTTON (ALWAYS VISIBLE) -->
    <div class="sticky-top bg-white shadow-sm">
      <div class="row align-items-center">
        <div class="col-md-8">
          <input type="text" class="form-control form-control-lg" placeholder="Search stocks (e.g. JINDAL, RELIANCE)" id="searchInput" autocomplete="off">
        </div>
        <div class="col-md-4 text-end">
          <button type="submit" class="btn btn-success btn-lg w-100">
            Add Selected Stocks
          </button>
        </div>
      </div>
    </div>

    <!-- STOCK LIST -->
    <div id="stockList" class="list-group mt-3">
      <div class="list-group-item text-center text-muted">Loading stocks...</div>
    </div>

    <!-- BOTTOM: ADD BUTTON (ALWAYS VISIBLE) -->
    <div class="mt-4 p-3 bg-white border-top sticky-bottom">
      <div class="text-center">
        <button type="submit" class="btn btn-success btn-lg px-5">
          Add Selected Stocks
        </button>
        <a href="/index" class="btn btn-outline-primary btn-lg ms-3">View Results</a>
      </div>
    </div>

  </div>
</form>

<script>
const searchInput = document.getElementById('searchInput');
const stockList = document.getElementById('stockList');

// Load stocks
function loadStocks(query = "") {
  fetch(`/search-stocks?query=${encodeURIComponent(query)}`)
    .then(r => r.text())
    .then(html => {
      stockList.innerHTML = html || '<div class="list-group-item text-center text-muted">No stocks found.</div>';
    })
    .catch(err => {
      stockList.innerHTML = '<div class="list-group-item text-danger">Error loading stocks.</div>';
      console.error(err);
    });
}

// Search on input
searchInput.addEventListener('input', () => {
  const query = searchInput.value.trim();
  loadStocks(query);
});

// Load all stocks on start
loadStocks();
</script>

</body>
</html>